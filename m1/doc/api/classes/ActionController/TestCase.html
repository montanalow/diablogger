<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <title>Class: ActionController::TestCase [Rails Framework Documentation]</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta http-equiv="Content-Script-Type" content="text/javascript" />
  <link rel="stylesheet" href="../.././rdoc-style.css" type="text/css" media="screen" />
  <script type="text/javascript">
  // <![CDATA[

  function popupCode( url ) {
    window.open(url, "Code", "resizable=yes,scrollbars=yes,toolbar=no,status=no,height=150,width=400")
  }

  function toggleCode( id ) {
    if ( document.getElementById )
      elem = document.getElementById( id );
    else if ( document.all )
      elem = eval( "document.all." + id );
    else
      return false;

    elemStyle = elem.style;

    if ( elemStyle.display != "block" ) {
      elemStyle.display = "block"
    } else {
      elemStyle.display = "none"
    }

    return true;
  }

  // Make codeblocks hidden by default
  document.writeln( "<style type=\"text/css\">div.method-source-code { display: none }<\/style>" )

  // ]]>
  </script>

</head>
<body>


    <div id="classHeader">
        <table class="header-table">
        <tr class="top-aligned-row">
          <td><strong>Class</strong></td>
          <td class="class-name-in-header">ActionController::TestCase</td>
        </tr>
        <tr class="top-aligned-row">
            <td><strong>In:</strong></td>
            <td>


                <a href="../../files/Users/montana/_bundle/ruby/1_9_1/bundler/gems/rails-16a5e918a06649ffac24fd5873b875daf66212ad-8c7e8976e97d96f514e22b04fc1afb9453134076/actionpack/lib/action_controller/test_case_rb.html">

                /Users/montana/.bundle/ruby/1.9.1/bundler/gems/rails-16a5e918a06649ffac24fd5873b875daf66212ad-8c7e8976e97d96f514e22b04fc1afb9453134076/actionpack/lib/action_controller/test_case.rb

                </a>


        <br />

            </td>
        </tr>


        <tr class="top-aligned-row">
            <td><strong>Parent:</strong></td>
            <td>

                <a href="../ActiveSupport/TestCase.html">

                ActiveSupport::TestCase

               </a>

            </td>
        </tr>

        </table>
    </div>
  <!-- banner header -->

  <div id="bodyContent">

  <div id="contextContent">

    <div id="description">
      <p>
Superclass for ActionController functional tests. Functional tests allow
you to test a single controller action per test method. This should not be
confused with integration tests (see ActionController::IntegrationTest),
which are more like &#8220;stories&#8221; that can involve multiple
controllers and mutliple actions (i.e. multiple different HTTP requests).
</p>
<h2>Basic example</h2>
<p>
Functional tests are written as follows:
</p>
<ol>
<li>First, one uses the <tt>get</tt>, <tt>post</tt>, <tt>put</tt>,
<tt>delete</tt> or <tt>head</tt> method to simulate an HTTP request.

</li>
<li>Then, one asserts whether the current state is as expected.
&#8220;State&#8221; can be anything: the controller&#8217;s HTTP response,
the database contents, etc.

</li>
</ol>
<p>
For example:
</p>
<pre>
  class BooksControllerTest &lt; ActionController::TestCase
    def test_create
      # Simulate a POST response with the given HTTP parameters.
      post(:create, :book =&gt; { :title =&gt; &quot;Love Hina&quot; })

      # Assert that the controller tried to redirect us to
      # the created book's URI.
      assert_response :found

      # Assert that the controller really put the book in the database.
      assert_not_nil Book.find_by_title(&quot;Love Hina&quot;)
    end
  end
</pre>
<h2>Special instance variables</h2>
<p>
<a href="TestCase.html">ActionController::TestCase</a> will also
automatically provide the following instance variables for use in the
tests:
</p>
<table>
<tr><td valign="top"><b>@controller</b>:</td><td>The controller instance that will be tested.

</td></tr>
<tr><td valign="top"><b>@request</b>:</td><td>An ActionController::TestRequest, representing the current HTTP request.
You can modify this object before sending the HTTP request. For example,
you might want to set some session properties before sending a GET request.

</td></tr>
<tr><td valign="top"><b>@response</b>:</td><td>An <a href="TestResponse.html">ActionController::TestResponse</a> object,
representing the response of the last HTTP response. In the above example,
<tt>@response</tt> becomes valid after calling <tt>post</tt>. If the
various assert methods are not sufficient, then you may use this object to
inspect the HTTP response in detail.

</td></tr>
</table>
<p>
(Earlier versions of <a href="../Rails.html">Rails</a> required each
functional test to subclass Test::Unit::TestCase and define @controller,
@request, @response in <tt>setup</tt>.)
</p>
<h2>Controller is automatically inferred</h2>
<p>
<a href="TestCase.html">ActionController::TestCase</a> will automatically
infer the controller under test from the test class name. If the controller
cannot be inferred from the test class name, you can explicitly set it with
<tt>tests</tt>.
</p>
<pre>
  class SpecialEdgeCaseWidgetsControllerTest &lt; ActionController::TestCase
    tests WidgetController
  end
</pre>
<h2><a href="Testing.html">Testing</a> controller internals</h2>
<p>
In addition to these specific assertions, you also have easy access to
various collections that the regular test/unit assertions can be used
against. These collections are:
</p>
<ul>
<li>assigns: Instance variables assigned in the action that are available for
the view.

</li>
<li>session: Objects being saved in the session.

</li>
<li>flash: The flash objects currently in the session.

</li>
<li>cookies: <a href="Cookies.html">Cookies</a> being sent to the user on this
request.

</li>
</ul>
<p>
These collections can be used just like any other hash:
</p>
<pre>
  assert_not_nil assigns(:person) # makes sure that a @person instance variable was set
  assert_equal &quot;Dave&quot;, cookies[:name] # makes sure that a cookie called :name was set as &quot;Dave&quot;
  assert flash.empty? # makes sure that there's nothing in the flash
</pre>
<p>
For historic reasons, the assigns hash uses string-based keys. So
assigns[:person] won&#8217;t work, but assigns[&#8220;person&#8221;] will.
To appease our yearning for symbols, though, an alternative accessor has
been devised using a method call instead of index referencing. So
assigns(:person) will work just like assigns[&#8220;person&#8221;], but
again, assigns[:person] will not work.
</p>
<p>
On top of the collections, you have the complete url that a given action
redirected to available in redirect_to_url.
</p>
<p>
For redirects within the same controller, you can even call follow_redirect
and the redirect will be followed, triggering another action call which can
then be asserted against.
</p>
<h2>Manipulating the request collections</h2>
<p>
The collections described above link to the response, so you can test if
what the actions were expected to do happened. But sometimes you also want
to manipulate these collections in the incoming request. This is really
only relevant for sessions and cookies, though. For sessions, you just do:
</p>
<pre>
  @request.session[:key] = &quot;value&quot;
  @request.cookies[&quot;key&quot;] = &quot;value&quot;
</pre>
<h2><a href="Testing.html">Testing</a> named routes</h2>
<p>
If you&#8217;re using named routes, they can be easily tested using the
original named routes&#8217; methods straight in the test case. Example:
</p>
<pre>
 assert_redirected_to page_url(:title =&gt; 'foo')
</pre>

    </div>

   </div>


    <div id="method-list">
      <h3 class="section-bar">Methods</h3>

      <div class="name-list">

        <a href="#M000365">controller_class</a>&nbsp;&nbsp;

        <a href="#M000364">controller_class=</a>&nbsp;&nbsp;

        <a href="#M000358">delete</a>&nbsp;&nbsp;

        <a href="#M000366">determine_default_controller_class</a>&nbsp;&nbsp;

        <a href="#M000355">get</a>&nbsp;&nbsp;

        <a href="#M000359">head</a>&nbsp;&nbsp;

        <a href="#M000356">post</a>&nbsp;&nbsp;

        <a href="#M000367">prepare_controller_class</a>&nbsp;&nbsp;

        <a href="#M000362">process</a>&nbsp;&nbsp;

        <a href="#M000357">put</a>&nbsp;&nbsp;

        <a href="#M000369">rescue_action_in_public!</a>&nbsp;&nbsp;

        <a href="#M000368">setup_controller_request_and_response</a>&nbsp;&nbsp;

        <a href="#M000363">tests</a>&nbsp;&nbsp;

        <a href="#M000361">xhr</a>&nbsp;&nbsp;

        <a href="#M000360">xml_http_request</a>&nbsp;&nbsp;

      </div>
    </div>

  </div>

    <!-- if includes -->

    <div id="includes">
      <h3 class="section-bar">Included Modules</h3>

      <div id="includes-list">

        <span class="include-name">ActionDispatch::TestProcess</span>

        <span class="include-name"><a href="TemplateAssertions.html">ActionController::TemplateAssertions</a></span>

        <span class="include-name"><a href="Testing.html">Testing</a></span>

        <span class="include-name">ActionDispatch::Assertions</span>

      </div>
    </div>

    <div id="section">

    <div id="class-list">
      <h3 class="section-bar">Classes and Modules</h3>

      Module <a href="TestCase/RaiseActionExceptions.html" class="link">ActionController::TestCase::RaiseActionExceptions</a><br />

    </div>



    <div id="attribute-list">
      <h3 class="section-bar">Attributes</h3>

      <div class="name-list">
        <table>

        <tr class="top-aligned-row context-row">
          <td class="context-item-name">request</td>

          <td class="context-item-value">&nbsp;[R]&nbsp;</td>

          <td class="context-item-desc"></td>
        </tr>

        <tr class="top-aligned-row context-row">
          <td class="context-item-name">response</td>

          <td class="context-item-value">&nbsp;[R]&nbsp;</td>

          <td class="context-item-desc"></td>
        </tr>

        </table>
      </div>
    </div>


    <!-- if method_list -->

    <div id="methods">

      <h3 class="section-bar">Public Class methods</h3>


      <div id="method-M000365" class="method-detail">
        <a name="M000365"></a>

        <div class="method-heading">

          <a href="#M000365" class="method-signature">

          <span class="method-name">controller_class</span><span class="method-args">()</span>

          </a>

        </div>

        <div class="method-description">

          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000365-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000365-source">
<pre>
     <span class="ruby-comment cmt"># File /Users/montana/.bundle/ruby/1.9.1/bundler/gems/rails-16a5e918a06649ffac24fd5873b875daf66212ad-8c7e8976e97d96f514e22b04fc1afb9453134076/actionpack/lib/action_controller/test_case.rb, line 403</span>
403:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">controller_class</span>
404:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">current_controller_class</span> = <span class="ruby-identifier">read_inheritable_attribute</span>(<span class="ruby-identifier">:controller_class</span>)
405:           <span class="ruby-identifier">current_controller_class</span>
406:         <span class="ruby-keyword kw">else</span>
407:           <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">controller_class</span> = <span class="ruby-identifier">determine_default_controller_class</span>(<span class="ruby-identifier">name</span>)
408:         <span class="ruby-keyword kw">end</span>
409:       <span class="ruby-keyword kw">end</span>
</pre>
          </div>

        </div>
      </div>


      <div id="method-M000364" class="method-detail">
        <a name="M000364"></a>

        <div class="method-heading">

          <a href="#M000364" class="method-signature">

          <span class="method-name">controller_class=</span><span class="method-args">(new_class)</span>

          </a>

        </div>

        <div class="method-description">

          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000364-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000364-source">
<pre>
     <span class="ruby-comment cmt"># File /Users/montana/.bundle/ruby/1.9.1/bundler/gems/rails-16a5e918a06649ffac24fd5873b875daf66212ad-8c7e8976e97d96f514e22b04fc1afb9453134076/actionpack/lib/action_controller/test_case.rb, line 398</span>
398:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">controller_class=</span>(<span class="ruby-identifier">new_class</span>)
399:         <span class="ruby-identifier">prepare_controller_class</span>(<span class="ruby-identifier">new_class</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">new_class</span>
400:         <span class="ruby-identifier">write_inheritable_attribute</span>(<span class="ruby-identifier">:controller_class</span>, <span class="ruby-identifier">new_class</span>)
401:       <span class="ruby-keyword kw">end</span>
</pre>
          </div>

        </div>
      </div>


      <div id="method-M000366" class="method-detail">
        <a name="M000366"></a>

        <div class="method-heading">

          <a href="#M000366" class="method-signature">

          <span class="method-name">determine_default_controller_class</span><span class="method-args">(name)</span>

          </a>

        </div>

        <div class="method-description">

          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000366-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000366-source">
<pre>
     <span class="ruby-comment cmt"># File /Users/montana/.bundle/ruby/1.9.1/bundler/gems/rails-16a5e918a06649ffac24fd5873b875daf66212ad-8c7e8976e97d96f514e22b04fc1afb9453134076/actionpack/lib/action_controller/test_case.rb, line 411</span>
411:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">determine_default_controller_class</span>(<span class="ruby-identifier">name</span>)
412:         <span class="ruby-identifier">name</span>.<span class="ruby-identifier">sub</span>(<span class="ruby-regexp re">/Test$/</span>, <span class="ruby-value str">''</span>).<span class="ruby-identifier">constantize</span>
413:       <span class="ruby-keyword kw">rescue</span> <span class="ruby-constant">NameError</span>
414:         <span class="ruby-keyword kw">nil</span>
415:       <span class="ruby-keyword kw">end</span>
</pre>
          </div>

        </div>
      </div>


      <div id="method-M000367" class="method-detail">
        <a name="M000367"></a>

        <div class="method-heading">

          <a href="#M000367" class="method-signature">

          <span class="method-name">prepare_controller_class</span><span class="method-args">(new_class)</span>

          </a>

        </div>

        <div class="method-description">

          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000367-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000367-source">
<pre>
     <span class="ruby-comment cmt"># File /Users/montana/.bundle/ruby/1.9.1/bundler/gems/rails-16a5e918a06649ffac24fd5873b875daf66212ad-8c7e8976e97d96f514e22b04fc1afb9453134076/actionpack/lib/action_controller/test_case.rb, line 417</span>
417:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">prepare_controller_class</span>(<span class="ruby-identifier">new_class</span>)
418:         <span class="ruby-identifier">new_class</span>.<span class="ruby-identifier">send</span> <span class="ruby-identifier">:include</span>, <span class="ruby-constant">RaiseActionExceptions</span>
419:       <span class="ruby-keyword kw">end</span>
</pre>
          </div>

        </div>
      </div>


      <div id="method-M000363" class="method-detail">
        <a name="M000363"></a>

        <div class="method-heading">

          <a href="#M000363" class="method-signature">

          <span class="method-name">tests</span><span class="method-args">(controller_class)</span>

          </a>

        </div>

        <div class="method-description">

          <p>
Sets the controller class name. Useful if the name can&#8217;t be inferred
from test class. Expects <tt><a
href="TestCase.html#M000365">controller_class</a></tt> as a constant.
Example: <tt>tests WidgetController</tt>.
</p>

          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000363-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000363-source">
<pre>
     <span class="ruby-comment cmt"># File /Users/montana/.bundle/ruby/1.9.1/bundler/gems/rails-16a5e918a06649ffac24fd5873b875daf66212ad-8c7e8976e97d96f514e22b04fc1afb9453134076/actionpack/lib/action_controller/test_case.rb, line 394</span>
394:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">tests</span>(<span class="ruby-identifier">controller_class</span>)
395:         <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">controller_class</span> = <span class="ruby-identifier">controller_class</span>
396:       <span class="ruby-keyword kw">end</span>
</pre>
          </div>

        </div>
      </div>


      <h3 class="section-bar">Public Instance methods</h3>


      <div id="method-M000358" class="method-detail">
        <a name="M000358"></a>

        <div class="method-heading">

          <a href="#M000358" class="method-signature">

          <span class="method-name">delete</span><span class="method-args">(action, parameters = nil, session = nil, flash = nil)</span>

          </a>

        </div>

        <div class="method-description">

          <p>
Executes a request simulating DELETE HTTP method and set/volley the
response
</p>

          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000358-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000358-source">
<pre>
     <span class="ruby-comment cmt"># File /Users/montana/.bundle/ruby/1.9.1/bundler/gems/rails-16a5e918a06649ffac24fd5873b875daf66212ad-8c7e8976e97d96f514e22b04fc1afb9453134076/actionpack/lib/action_controller/test_case.rb, line 306</span>
306:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">delete</span>(<span class="ruby-identifier">action</span>, <span class="ruby-identifier">parameters</span> = <span class="ruby-keyword kw">nil</span>, <span class="ruby-identifier">session</span> = <span class="ruby-keyword kw">nil</span>, <span class="ruby-identifier">flash</span> = <span class="ruby-keyword kw">nil</span>)
307:       <span class="ruby-identifier">process</span>(<span class="ruby-identifier">action</span>, <span class="ruby-identifier">parameters</span>, <span class="ruby-identifier">session</span>, <span class="ruby-identifier">flash</span>, <span class="ruby-value str">&quot;DELETE&quot;</span>)
308:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>

        </div>
      </div>


      <div id="method-M000355" class="method-detail">
        <a name="M000355"></a>

        <div class="method-heading">

          <a href="#M000355" class="method-signature">

          <span class="method-name">get</span><span class="method-args">(action, parameters = nil, session = nil, flash = nil)</span>

          </a>

        </div>

        <div class="method-description">

          <p>
Executes a request simulating GET HTTP method and set/volley the response
</p>

          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000355-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000355-source">
<pre>
     <span class="ruby-comment cmt"># File /Users/montana/.bundle/ruby/1.9.1/bundler/gems/rails-16a5e918a06649ffac24fd5873b875daf66212ad-8c7e8976e97d96f514e22b04fc1afb9453134076/actionpack/lib/action_controller/test_case.rb, line 291</span>
291:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">get</span>(<span class="ruby-identifier">action</span>, <span class="ruby-identifier">parameters</span> = <span class="ruby-keyword kw">nil</span>, <span class="ruby-identifier">session</span> = <span class="ruby-keyword kw">nil</span>, <span class="ruby-identifier">flash</span> = <span class="ruby-keyword kw">nil</span>)
292:       <span class="ruby-identifier">process</span>(<span class="ruby-identifier">action</span>, <span class="ruby-identifier">parameters</span>, <span class="ruby-identifier">session</span>, <span class="ruby-identifier">flash</span>, <span class="ruby-value str">&quot;GET&quot;</span>)
293:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>

        </div>
      </div>


      <div id="method-M000359" class="method-detail">
        <a name="M000359"></a>

        <div class="method-heading">

          <a href="#M000359" class="method-signature">

          <span class="method-name">head</span><span class="method-args">(action, parameters = nil, session = nil, flash = nil)</span>

          </a>

        </div>

        <div class="method-description">

          <p>
Executes a request simulating HEAD HTTP method and set/volley the response
</p>

          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000359-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000359-source">
<pre>
     <span class="ruby-comment cmt"># File /Users/montana/.bundle/ruby/1.9.1/bundler/gems/rails-16a5e918a06649ffac24fd5873b875daf66212ad-8c7e8976e97d96f514e22b04fc1afb9453134076/actionpack/lib/action_controller/test_case.rb, line 311</span>
311:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">head</span>(<span class="ruby-identifier">action</span>, <span class="ruby-identifier">parameters</span> = <span class="ruby-keyword kw">nil</span>, <span class="ruby-identifier">session</span> = <span class="ruby-keyword kw">nil</span>, <span class="ruby-identifier">flash</span> = <span class="ruby-keyword kw">nil</span>)
312:       <span class="ruby-identifier">process</span>(<span class="ruby-identifier">action</span>, <span class="ruby-identifier">parameters</span>, <span class="ruby-identifier">session</span>, <span class="ruby-identifier">flash</span>, <span class="ruby-value str">&quot;HEAD&quot;</span>)
313:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>

        </div>
      </div>


      <div id="method-M000356" class="method-detail">
        <a name="M000356"></a>

        <div class="method-heading">

          <a href="#M000356" class="method-signature">

          <span class="method-name">post</span><span class="method-args">(action, parameters = nil, session = nil, flash = nil)</span>

          </a>

        </div>

        <div class="method-description">

          <p>
Executes a request simulating POST HTTP method and set/volley the response
</p>

          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000356-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000356-source">
<pre>
     <span class="ruby-comment cmt"># File /Users/montana/.bundle/ruby/1.9.1/bundler/gems/rails-16a5e918a06649ffac24fd5873b875daf66212ad-8c7e8976e97d96f514e22b04fc1afb9453134076/actionpack/lib/action_controller/test_case.rb, line 296</span>
296:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">post</span>(<span class="ruby-identifier">action</span>, <span class="ruby-identifier">parameters</span> = <span class="ruby-keyword kw">nil</span>, <span class="ruby-identifier">session</span> = <span class="ruby-keyword kw">nil</span>, <span class="ruby-identifier">flash</span> = <span class="ruby-keyword kw">nil</span>)
297:       <span class="ruby-identifier">process</span>(<span class="ruby-identifier">action</span>, <span class="ruby-identifier">parameters</span>, <span class="ruby-identifier">session</span>, <span class="ruby-identifier">flash</span>, <span class="ruby-value str">&quot;POST&quot;</span>)
298:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>

        </div>
      </div>


      <div id="method-M000362" class="method-detail">
        <a name="M000362"></a>

        <div class="method-heading">

          <a href="#M000362" class="method-signature">

          <span class="method-name">process</span><span class="method-args">(action, parameters = nil, session = nil, flash = nil, http_method = 'GET')</span>

          </a>

        </div>

        <div class="method-description">

          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000362-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000362-source">
<pre>
     <span class="ruby-comment cmt"># File /Users/montana/.bundle/ruby/1.9.1/bundler/gems/rails-16a5e918a06649ffac24fd5873b875daf66212ad-8c7e8976e97d96f514e22b04fc1afb9453134076/actionpack/lib/action_controller/test_case.rb, line 325</span>
325:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">process</span>(<span class="ruby-identifier">action</span>, <span class="ruby-identifier">parameters</span> = <span class="ruby-keyword kw">nil</span>, <span class="ruby-identifier">session</span> = <span class="ruby-keyword kw">nil</span>, <span class="ruby-identifier">flash</span> = <span class="ruby-keyword kw">nil</span>, <span class="ruby-identifier">http_method</span> = <span class="ruby-value str">'GET'</span>)
326:       <span class="ruby-comment cmt"># Sanity check for required instance variables so we can give an</span>
327:       <span class="ruby-comment cmt"># understandable error message.</span>
328:       <span class="ruby-node">%w(@routes @controller @request @response)</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">iv_name</span><span class="ruby-operator">|</span>
329:         <span class="ruby-keyword kw">if</span> <span class="ruby-operator">!</span>(<span class="ruby-identifier">instance_variable_names</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">iv_name</span>) <span class="ruby-operator">||</span> <span class="ruby-identifier">instance_variable_names</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">iv_name</span>.<span class="ruby-identifier">to_sym</span>)) <span class="ruby-operator">||</span> <span class="ruby-identifier">instance_variable_get</span>(<span class="ruby-identifier">iv_name</span>).<span class="ruby-identifier">nil?</span>
330:           <span class="ruby-identifier">raise</span> <span class="ruby-node">&quot;#{iv_name} is nil: make sure you set it in your test's setup method.&quot;</span>
331:         <span class="ruby-keyword kw">end</span>
332:       <span class="ruby-keyword kw">end</span>
333: 
334:       <span class="ruby-ivar">@request</span>.<span class="ruby-identifier">recycle!</span>
335:       <span class="ruby-ivar">@response</span>.<span class="ruby-identifier">recycle!</span>
336:       <span class="ruby-ivar">@controller</span>.<span class="ruby-identifier">response_body</span> = <span class="ruby-keyword kw">nil</span>
337:       <span class="ruby-ivar">@controller</span>.<span class="ruby-identifier">formats</span> = <span class="ruby-keyword kw">nil</span>
338:       <span class="ruby-ivar">@controller</span>.<span class="ruby-identifier">params</span> = <span class="ruby-keyword kw">nil</span>
339: 
340:       <span class="ruby-ivar">@html_document</span> = <span class="ruby-keyword kw">nil</span>
341:       <span class="ruby-ivar">@request</span>.<span class="ruby-identifier">env</span>[<span class="ruby-value str">'REQUEST_METHOD'</span>] = <span class="ruby-identifier">http_method</span>
342: 
343:       <span class="ruby-identifier">parameters</span> <span class="ruby-operator">||=</span> {}
344:       <span class="ruby-ivar">@request</span>.<span class="ruby-identifier">assign_parameters</span>(<span class="ruby-ivar">@routes</span>, <span class="ruby-ivar">@controller</span>.<span class="ruby-identifier">class</span>.<span class="ruby-identifier">name</span>.<span class="ruby-identifier">underscore</span>.<span class="ruby-identifier">sub</span>(<span class="ruby-regexp re">/_controller$/</span>, <span class="ruby-value str">''</span>), <span class="ruby-identifier">action</span>.<span class="ruby-identifier">to_s</span>, <span class="ruby-identifier">parameters</span>)
345: 
346:       <span class="ruby-ivar">@request</span>.<span class="ruby-identifier">session</span> = <span class="ruby-constant">ActionController</span><span class="ruby-operator">::</span><span class="ruby-constant">TestSession</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">session</span>) <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">session</span>.<span class="ruby-identifier">nil?</span>
347:       <span class="ruby-ivar">@request</span>.<span class="ruby-identifier">session</span>[<span class="ruby-value str">&quot;flash&quot;</span>] = <span class="ruby-ivar">@request</span>.<span class="ruby-identifier">flash</span>.<span class="ruby-identifier">update</span>(<span class="ruby-identifier">flash</span> <span class="ruby-operator">||</span> {})
348:       <span class="ruby-ivar">@request</span>.<span class="ruby-identifier">session</span>[<span class="ruby-value str">&quot;flash&quot;</span>].<span class="ruby-identifier">sweep</span>
349: 
350:       <span class="ruby-ivar">@controller</span>.<span class="ruby-identifier">request</span> = <span class="ruby-ivar">@request</span>
351:       <span class="ruby-ivar">@controller</span>.<span class="ruby-identifier">params</span>.<span class="ruby-identifier">merge!</span>(<span class="ruby-identifier">parameters</span>)
352:       <span class="ruby-identifier">build_request_uri</span>(<span class="ruby-identifier">action</span>, <span class="ruby-identifier">parameters</span>)
353:       <span class="ruby-constant">Base</span>.<span class="ruby-identifier">class_eval</span> { <span class="ruby-identifier">include</span> <span class="ruby-constant">Testing</span> }
354:       <span class="ruby-ivar">@controller</span>.<span class="ruby-identifier">process_with_new_base_test</span>(<span class="ruby-ivar">@request</span>, <span class="ruby-ivar">@response</span>)
355:       <span class="ruby-ivar">@request</span>.<span class="ruby-identifier">session</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-value str">'flash'</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@request</span>.<span class="ruby-identifier">session</span>[<span class="ruby-value str">'flash'</span>].<span class="ruby-identifier">blank?</span>
356:       <span class="ruby-ivar">@response</span>
357:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>

        </div>
      </div>


      <div id="method-M000357" class="method-detail">
        <a name="M000357"></a>

        <div class="method-heading">

          <a href="#M000357" class="method-signature">

          <span class="method-name">put</span><span class="method-args">(action, parameters = nil, session = nil, flash = nil)</span>

          </a>

        </div>

        <div class="method-description">

          <p>
Executes a request simulating PUT HTTP method and set/volley the response
</p>

          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000357-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000357-source">
<pre>
     <span class="ruby-comment cmt"># File /Users/montana/.bundle/ruby/1.9.1/bundler/gems/rails-16a5e918a06649ffac24fd5873b875daf66212ad-8c7e8976e97d96f514e22b04fc1afb9453134076/actionpack/lib/action_controller/test_case.rb, line 301</span>
301:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">put</span>(<span class="ruby-identifier">action</span>, <span class="ruby-identifier">parameters</span> = <span class="ruby-keyword kw">nil</span>, <span class="ruby-identifier">session</span> = <span class="ruby-keyword kw">nil</span>, <span class="ruby-identifier">flash</span> = <span class="ruby-keyword kw">nil</span>)
302:       <span class="ruby-identifier">process</span>(<span class="ruby-identifier">action</span>, <span class="ruby-identifier">parameters</span>, <span class="ruby-identifier">session</span>, <span class="ruby-identifier">flash</span>, <span class="ruby-value str">&quot;PUT&quot;</span>)
303:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>

        </div>
      </div>


      <div id="method-M000369" class="method-detail">
        <a name="M000369"></a>

        <div class="method-heading">

          <a href="#M000369" class="method-signature">

          <span class="method-name">rescue_action_in_public!</span><span class="method-args">()</span>

          </a>

        </div>

        <div class="method-description">

          <p>
Cause the action to be rescued according to the regular rules for
rescue_action when the visitor is not local
</p>

          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000369-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000369-source">
<pre>
     <span class="ruby-comment cmt"># File /Users/montana/.bundle/ruby/1.9.1/bundler/gems/rails-16a5e918a06649ffac24fd5873b875daf66212ad-8c7e8976e97d96f514e22b04fc1afb9453134076/actionpack/lib/action_controller/test_case.rb, line 439</span>
439:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">rescue_action_in_public!</span>
440:       <span class="ruby-ivar">@request</span>.<span class="ruby-identifier">remote_addr</span> = <span class="ruby-value str">'208.77.188.166'</span> <span class="ruby-comment cmt"># example.com</span>
441:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>

        </div>
      </div>


      <div id="method-M000368" class="method-detail">
        <a name="M000368"></a>

        <div class="method-heading">

          <a href="#M000368" class="method-signature">

          <span class="method-name">setup_controller_request_and_response</span><span class="method-args">()</span>

          </a>

        </div>

        <div class="method-description">

          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000368-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000368-source">
<pre>
     <span class="ruby-comment cmt"># File /Users/montana/.bundle/ruby/1.9.1/bundler/gems/rails-16a5e918a06649ffac24fd5873b875daf66212ad-8c7e8976e97d96f514e22b04fc1afb9453134076/actionpack/lib/action_controller/test_case.rb, line 422</span>
422:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">setup_controller_request_and_response</span>
423:       <span class="ruby-ivar">@request</span> = <span class="ruby-constant">TestRequest</span>.<span class="ruby-identifier">new</span>
424:       <span class="ruby-ivar">@response</span> = <span class="ruby-constant">TestResponse</span>.<span class="ruby-identifier">new</span>
425: 
426:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">klass</span> = <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">class</span>.<span class="ruby-identifier">controller_class</span>
427:         <span class="ruby-ivar">@controller</span> <span class="ruby-operator">||=</span> <span class="ruby-identifier">klass</span>.<span class="ruby-identifier">new</span> <span class="ruby-keyword kw">rescue</span> <span class="ruby-keyword kw">nil</span>
428:       <span class="ruby-keyword kw">end</span>
429: 
430:       <span class="ruby-ivar">@request</span>.<span class="ruby-identifier">env</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-value str">'PATH_INFO'</span>)
431: 
432:       <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@controller</span>
433:         <span class="ruby-ivar">@controller</span>.<span class="ruby-identifier">request</span> = <span class="ruby-ivar">@request</span>
434:         <span class="ruby-ivar">@controller</span>.<span class="ruby-identifier">params</span> = {}
435:       <span class="ruby-keyword kw">end</span>
436:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>

        </div>
      </div>


      <div id="method-M000361" class="method-detail">
        <a name="M000361"></a>

        <div class="method-heading">

          <span class="method-name">xhr</span><span class="method-args">(request_method, action, parameters = nil, session = nil, flash = nil)</span>

        </div>

        <div class="method-description">

          <p>
Alias for <a href="TestCase.html#M000360">xml_http_request</a>
</p>

        </div>
      </div>


      <div id="method-M000360" class="method-detail">
        <a name="M000360"></a>

        <div class="method-heading">

          <a href="#M000360" class="method-signature">

          <span class="method-name">xml_http_request</span><span class="method-args">(request_method, action, parameters = nil, session = nil, flash = nil)</span>

          </a>

        </div>

        <div class="method-description">

          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000360-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000360-source">
<pre>
     <span class="ruby-comment cmt"># File /Users/montana/.bundle/ruby/1.9.1/bundler/gems/rails-16a5e918a06649ffac24fd5873b875daf66212ad-8c7e8976e97d96f514e22b04fc1afb9453134076/actionpack/lib/action_controller/test_case.rb, line 315</span>
315:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">xml_http_request</span>(<span class="ruby-identifier">request_method</span>, <span class="ruby-identifier">action</span>, <span class="ruby-identifier">parameters</span> = <span class="ruby-keyword kw">nil</span>, <span class="ruby-identifier">session</span> = <span class="ruby-keyword kw">nil</span>, <span class="ruby-identifier">flash</span> = <span class="ruby-keyword kw">nil</span>)
316:       <span class="ruby-ivar">@request</span>.<span class="ruby-identifier">env</span>[<span class="ruby-value str">'HTTP_X_REQUESTED_WITH'</span>] = <span class="ruby-value str">'XMLHttpRequest'</span>
317:       <span class="ruby-ivar">@request</span>.<span class="ruby-identifier">env</span>[<span class="ruby-value str">'HTTP_ACCEPT'</span>] <span class="ruby-operator">||=</span>  [<span class="ruby-constant">Mime</span><span class="ruby-operator">::</span><span class="ruby-constant">JS</span>, <span class="ruby-constant">Mime</span><span class="ruby-operator">::</span><span class="ruby-constant">HTML</span>, <span class="ruby-constant">Mime</span><span class="ruby-operator">::</span><span class="ruby-constant">XML</span>, <span class="ruby-value str">'text/xml'</span>, <span class="ruby-constant">Mime</span><span class="ruby-operator">::</span><span class="ruby-constant">ALL</span>].<span class="ruby-identifier">join</span>(<span class="ruby-value str">', '</span>)
318:       <span class="ruby-identifier">returning</span> <span class="ruby-identifier">__send__</span>(<span class="ruby-identifier">request_method</span>, <span class="ruby-identifier">action</span>, <span class="ruby-identifier">parameters</span>, <span class="ruby-identifier">session</span>, <span class="ruby-identifier">flash</span>) <span class="ruby-keyword kw">do</span>
319:         <span class="ruby-ivar">@request</span>.<span class="ruby-identifier">env</span>.<span class="ruby-identifier">delete</span> <span class="ruby-value str">'HTTP_X_REQUESTED_WITH'</span>
320:         <span class="ruby-ivar">@request</span>.<span class="ruby-identifier">env</span>.<span class="ruby-identifier">delete</span> <span class="ruby-value str">'HTTP_ACCEPT'</span>
321:       <span class="ruby-keyword kw">end</span>
322:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>

        </div>
      </div>



    </div>




  </div>

<div id="validator-badges">
  <p><small><a href="http://validator.w3.org/check/referer">[Validate]</a></small></p>
</div>

</body>
</html>
